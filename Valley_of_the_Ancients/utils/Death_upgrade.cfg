#textdomain wesnoth

#define NEW_FEEDING_EVENT SIDE
    [event]
        name=die
        first_time_only=no

        [filter]
            [not]
                [filter_wml]
                    [status]
                        not_living="yes"
                    [/status]
                [/filter_wml]
            [/not]
        [/filter]

        [filter_second]
            ability=feeding{SIDE}
        [/filter_second]

        [unstore_unit]
            variable=second_unit
            {COLOR_HEAL}
            text="+$custom_feed{SIDE}|"+_" max HP"
            find_vacant=no
        [/unstore_unit]

        [object]
            silent=yes
            duration=forever

            [filter]
                x,y=$x2,$y2
            [/filter]

            [effect]
                apply_to=hitpoints
                increase_total=$custom_feed{SIDE}|
                increase=$custom_feed{SIDE}|
            [/effect]
        [/object]
    [/event]
#enddef

{NEW_FEEDING_EVENT 2}
{NEW_FEEDING_EVENT 3}
{NEW_FEEDING_EVENT 4}
{NEW_FEEDING_EVENT 5}
{NEW_FEEDING_EVENT 6}
{NEW_FEEDING_EVENT 7}

#undef NEW_FEEDING_EVENT SIDE
#define STORE_VARIABLES
    [store_gold]
        side=$side_number
        variable=gold
    [/store_gold]
    [store_unit]
        [filter]
            side=$side_number
            x,y=$x1,$y1
        [/filter]
        variable=unit
    [/store_unit]
#enddef

#define VOTA_COLOSSEUM_UPGRADE
    [event]
        name=moveto
        first_time_only=no

        [filter]
            canrecruit=yes
            x,y=23,29
        [/filter]

        {VARIABLE finished no}
        [while]
            [variable]
                name=finished
                equals=no
            [/variable]
            [do]
                {STORE_VARIABLES}

                [message]
                    speaker=narrator
                    message= _ "<span color='gold'>Gold: $gold|</span>"

                    [option]
                        message={MENU_IMG_TXT "misc/red-x.png" (_"Done")}
                        [command]
                            {VARIABLE finished yes}
                        [/command]
                    [/option]

                    [option]
                        message={MENU_IMG_TXT "icons/dress_silk_green.png" "Enhancement"}
                        [command]
                            {VARIABLE finished_sub no}
                            [while]
                                [variable]
                                    name=finished_sub
                                    equals=no
                                [/variable]
                                [do]
                                    {STORE_VARIABLES}

                                    [message]
                                        speaker=narrator
                                        caption= _ "Enhancement"
                                        image=wesnoth-icon.png
                                        message= _ "<span color='gold'>Gold: $gold|</span>"

                                        [option]
                                            message={MENU_IMG_TXT "misc/red-x.png" (_"Done")}
                                            [command]
                                                {VARIABLE finished_sub yes}
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "items/sword.png" (_"10 gold: +1 melee damage")}
                                            [show_if]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=10
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=attack
                                                        range=melee
                                                        increase_damage=1
                                                    [/effect]
                                                [/object]
                                                [gold]
                                                    amount=-10
                                                    side=$side_number
                                                [/gold]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "items/bow.png" (_"10 gold: +1 ranged damage")}
                                            [show_if]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=10
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [gold]
                                                    amount=-10
                                                    side=$side_number
                                                [/gold]
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=attack
                                                        range=ranged
                                                        increase_damage=1
                                                    [/effect]
                                                [/object]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "items/bonestack.png" (_"16 gold: +1 both Damage")}
                                            [show_if]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=16
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [gold]
                                                    amount=-16
                                                    side=$side_number
                                                [/gold]
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=attack
                                                        increase_damage=1
                                                    [/effect]
                                                [/object]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "items/dummy.png" (_"35 gold: +1 melee strikes")}
                                            [show_if]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=35
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [gold]
                                                    amount=-35
                                                    side=$side_number
                                                [/gold]
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=attack
                                                        range=melee
                                                        increase_attacks=1
                                                    [/effect]
                                                [/object]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "items/orcish-flag.png" (_"35 gold: +1 ranged strikes")}
                                            [show_if]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=35
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [gold]
                                                    amount=-35
                                                    side=$side_number
                                                [/gold]
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=attack
                                                        range=ranged
                                                        increase_attacks=1
                                                    [/effect]
                                                [/object]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "items/scarecrow.png" (_"56 gold: +1 both strikes")}
                                            [show_if]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=56
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [gold]
                                                    amount=-56
                                                    side=$side_number
                                                [/gold]
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=attack
                                                        increase_attacks=1
                                                    [/effect]
                                                [/object]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "items/potion-green.png" (_"5 gold: +5 hitpoints")}
                                            [show_if]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=5
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [gold]
                                                    amount=-5
                                                    side=$side_number
                                                [/gold]
                                                [object]
                                                    [effect]
                                                        apply_to=hitpoints
                                                        increase_total=5
                                                        heal_full=yes
                                                    [/effect]
                                                    silent=yes
                                                [/object]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "items/ring-white.png" (_"10 gold: +1 movement points")}
                                            [show_if]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=10
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [gold]
                                                    amount=-10
                                                    side=$side_number
                                                [/gold]
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=movement
                                                        increase=1
                                                    [/effect]
                                                [/object]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "items/ornate1.png" (_"15 gold: +4 regenerates ability")}
                                            [show_if]
                                                [have_unit]
                                                    side=$side_number
                                                    ability=regenerates
                                                [/have_unit]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=15
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [gold]
                                                    amount=-15
                                                    side=$side_number
                                                [/gold]

                                                [store_unit]
                                                    [filter]
                                                        side=$side_number
                                                        x,y=$x1,$y1
                                                    [/filter]
                                                    variable=regen_store
                                                [/store_unit]

                                                {VARIABLE custom_regen$side_number| "$regen_store.abilities.regenerate.value"}
                                                {VARIABLE_OP custom_regen$side_number| add 4}
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=remove_ability
                                                        [abilities]
                                                            [regenerate]
                                                                id=regenerates
                                                            [/regenerate]
                                                        [/abilities]
                                                    [/effect]
                                                    [effect]
                                                        apply_to=new_ability
                                                        [abilities]
                                                            [regenerate]
                                                                value=$custom_regen$side_number||
                                                                id=regenerates
                                                                name= _ "regenerates +$custom_regen$side_number||"
                                                                description= _ "Regenerates $custom_regen$side_number||:
The unit will heal itself $custom_regen$side_number|| HP per turn. If it is poisoned, it will remove the poison instead of healing."
                                                                affect_self=yes
                                                                poison=cured
                                                            [/regenerate]
                                                        [/abilities]
                                                    [/effect]
                                                [/object]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "items/flower1.png" (_"5 gold: +4hp heals ability")}
                                            [show_if]
                                                [have_unit]
                                                    side=$side_number
                                                    ability=healing
                                                [/have_unit]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=5
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [gold]
                                                    amount=-5
                                                    side=$side_number
                                                [/gold]
                                                [store_unit]
                                                    [filter]
                                                        side=$side_number
                                                        x,y=$x1,$y1
                                                    [/filter]
                                                    variable=healing_store
                                                [/store_unit]

                                                {VARIABLE custom_healing$side_number| "$healing_store.abilities.healing.value"}
                                                {VARIABLE_OP custom_healing$side_number| add 4}
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=remove_ability
                                                        [abilities]
                                                            [heals]
                                                                id=healing
                                                            [/heals]
                                                        [/abilities]
                                                    [/effect]
                                                    [effect]
                                                        apply_to=new_ability
                                                        [abilities]
                                                            [heals]
                                                                value=$custom_healing$side_number||
                                                                id=healing
                                                                affect_allies=yes
                                                                name= _ "heals +$custom_healing$side_number||"
                                                                description=  _ "Heals +$custom_healing$side_number||:
Allows the unit to heal adjacent friendly units at the beginning of each turn.

A unit cared for by this healer may heal up to $custom_healing$side_number|| HP per turn, or stop poison from taking effect for that turn.
A poisoned unit cannot be cured of its poison by a healer, and must seek the care of a village or a unit that can cure."
                                                                affect_self=no
                                                                poison=slowed
                                                                [affect_adjacent]
                                                                    adjacent=n,ne,se,s,sw,nw
                                                                [/affect_adjacent]
                                                            [/heals]
                                                        [/abilities]
                                                    [/effect]
                                                [/object]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "items/potion-red.png" (_"10 gold: +1hp feeding ability")}
                                            [show_if]
                                                [have_unit]
                                                    side=$side_number
                                                    ability=feeding$side_number
                                                [/have_unit]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=10
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [gold]
                                                    amount=-10
                                                    side=$side_number
                                                [/gold]

                                                {VARIABLE_OP custom_feed$side_number| add 1}
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=remove_ability
                                                        [abilities]
                                                            [dummy]
                                                                id=feeding
                                                            [/dummy]
                                                        [/abilities]
                                                    [/effect]
                                                    [effect]
                                                        apply_to=new_ability
                                                        [abilities]
                                                            [dummy]
                                                                id=feeding$side_number|
                                                                name= _ "feeding +$custom_feed$side_number||"
                                                                female_name= _ "female^feeding +$custom_feed$side_number||"
                                                                description=_ "Feeding +$custom_feed$side_number||:
This unit gains $custom_feed$side_number|| hitpoint added to its maximum whenever it kills a living unit."
                                                            [/dummy]
                                                        [/abilities]
                                                    [/effect]
                                                [/object]
                                            [/command]
                                        [/option]
                                    [/message]
                                [/do]
                            [/while]
                        [/command]
                    [/option]

                    [option]
                        [show_if]
                            [have_unit]
                                side=$side_number
                                [not]
                                    type=Ghost,Wraith,Spectre
                                [/not]
                            [/have_unit]
                        [/show_if]
                        message={MENU_IMG_TXT "icons/shield_wooden.png" (_"Resistances")}
                        [command]
                            {VARIABLE finished_sub no}
                            [while]
                                [variable]
                                    name=finished_sub
                                    equals=no
                                [/variable]
                                [do]
                                    {STORE_VARIABLES}

                                    {VARIABLE resistance.blade 100}
                                    {VARIABLE resistance.pierce 100}
                                    {VARIABLE resistance.impact 100}
                                    {VARIABLE resistance.fire 100}
                                    {VARIABLE resistance.cold 100}
                                    {VARIABLE resistance.arcane 100}
                                    {VARIABLE_OP resistance.blade add -$unit.resistance.blade|}
                                    {VARIABLE_OP resistance.pierce add -$unit.resistance.pierce|}
                                    {VARIABLE_OP resistance.impact add -$unit.resistance.impact|}
                                    {VARIABLE_OP resistance.fire add -$unit.resistance.fire|}
                                    {VARIABLE_OP resistance.cold add -$unit.resistance.cold|}
                                    {VARIABLE_OP resistance.arcane add -$unit.resistance.arcane|}

                                    [message]
                                        speaker=narrator
                                        caption= _ "Resistances"
                                        message= _ "<span color='gold'>Gold: $gold|</span>
<b>Upgrades left: $resup_left_$side_number||</b>

<i>Current resistances:</i>
<small>blade: $resistance.blade|%
pierce: $resistance.pierce|%
impact: $resistance.impact|%
fire: $resistance.fire|%
cold: $resistance.cold|%
arcane: $resistance.arcane|%</small>"

                                        [option]
                                            message={MENU_IMG_TXT "misc/red-x.png" (_"Done")}
                                            [command]
                                                {VARIABLE finished_sub yes}
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "attacks/sword-human.png" "15 gold: +10% blade resistance"}
                                            [show_if]
                                                [variable]
                                                    name=resistance.blade
                                                    less_than_equal_to=100
                                                [/variable]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=15
                                                [/variable]
                                                [variable]
                                                    name=resup_left_$side_number|
                                                    greater_than=0
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [gold]
                                                    amount=-15
                                                    side=$side_number
                                                [/gold]
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=resistance
                                                        replace=no
                                                        [resistance]
                                                            blade=-10
                                                        [/resistance]
                                                    [/effect]
                                                [/object]
                                                {VARIABLE_OP resup_left_$side_number| sub 1}
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "attacks/bow.png" "15 gold: +10% pierce resistance"}
                                            [show_if]
                                                [variable]
                                                    name=resistance.pierce
                                                    less_than_equal_to=100
                                                [/variable]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=15
                                                [/variable]
                                                [variable]
                                                    name=resup_left_$side_number|
                                                    greater_than=0
                                                [/variable]
                                            [/show_if]

                                            [command]
                                                [gold]
                                                    amount=-15
                                                    side=$side_number
                                                [/gold]
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=resistance
                                                        replace=no
                                                        [resistance]
                                                            pierce=-10
                                                        [/resistance]
                                                    [/effect]
                                                [/object]
                                                {VARIABLE_OP resup_left_$side_number| add -1}
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "attacks/fist-human.png" "15 gold: +10% impact resistance"}
                                            [show_if]
                                                [variable]
                                                    name=resistance.impact
                                                    less_than_equal_to=100
                                                [/variable]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=15
                                                [/variable]
                                                [variable]
                                                    name=resup_left_$side_number|
                                                    greater_than=0
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [gold]
                                                    amount=-15
                                                    side=$side_number
                                                [/gold]
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=resistance
                                                        replace=no
                                                        [resistance]
                                                            impact=-10
                                                        [/resistance]
                                                    [/effect]
                                                [/object]
                                                {VARIABLE_OP resup_left_$side_number| add -1}
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "attacks/fire-blast.png" "15 gold: +10% fire resistance"}
                                            [show_if]
                                                [variable]
                                                    name=resistance.fire
                                                    less_than_equal_to=100
                                                [/variable]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=15
                                                [/variable]
                                                [variable]
                                                    name=resup_left_$side_number|
                                                    greater_than=0
                                                [/variable]
                                            [/show_if]

                                            [command]
                                                [gold]
                                                    amount=-15
                                                    side=$side_number
                                                [/gold]
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=resistance
                                                        replace=no
                                                        [resistance]
                                                            fire=-10
                                                        [/resistance]
                                                    [/effect]
                                                [/object]
                                                {VARIABLE_OP resup_left_$side_number| add -1}
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "attacks/dark-missile.png" "15 gold: +10% cold resistance"}
                                            [show_if]
                                                [variable]
                                                    name=resistance.cold
                                                    less_than_equal_to=100
                                                [/variable]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=15
                                                [/variable]
                                                [variable]
                                                    name=resup_left_$side_number|
                                                    greater_than=0
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [gold]
                                                    amount=-15
                                                    side=$side_number
                                                [/gold]
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=resistance
                                                        replace=no
                                                        [resistance]
                                                            cold=-10
                                                        [/resistance]
                                                    [/effect]
                                                [/object]
                                                {VARIABLE_OP resup_left_$side_number| add -1}
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "attacks/lightbeam.png" "15 gold: +10% arcane resistance"}
                                            [show_if]
                                                [variable]
                                                    name=resistance.arcane
                                                    less_than_equal_to=100
                                                [/variable]
                                                [variable]
                                                    name=gold
                                                    greater_than_equal_to=15
                                                [/variable]
                                                [variable]
                                                    name=resup_left_$side_number|
                                                    greater_than=0
                                                [/variable]
                                            [/show_if]
                                            [command]
                                                [gold]
                                                    amount=-15
                                                    side=$side_number
                                                [/gold]
                                                [object]
                                                    silent=yes
                                                    [effect]
                                                        apply_to=resistance
                                                        replace=no
                                                        [resistance]
                                                            arcane=-10
                                                        [/resistance]
                                                    [/effect]
                                                [/object]
                                                {VARIABLE_OP resup_left_$side_number| add -1}
                                            [/command]
                                        [/option]

                                        image=wesnoth-icon.png
                                    [/message]
                                    [redraw]
                                    [/redraw]
                                [/do]
                            [/while]
                        [/command]
                    [/option]

                    [option]
                        message={MENU_IMG_TXT "icons/boots_elven.png" (_"Movement Costs")}
                        [command]
                            {VARIABLE finished_sub no}
                            [while]
                                [variable]
                                    name=finished_sub
                                    equals=no
                                [/variable]
                                [do]
                                    {STORE_VARIABLES}

                                    [message]
                                        speaker=narrator
                                        caption= _ "Movement Costs"
                                        message= _ "<span color='gold'>Gold: $gold|</span>
<b>Training left: $terup_left_$side_number||</b>

<i>Current movement costs:</i>
<small>flat: $unit.movement_costs.flat|
forest: $unit.movement_costs.forest|
hills: $unit.movement_costs.hills|
mountains: $unit.movement_costs.mountains|
sand: $unit.movement_costs.sand|
frozen: $unit.movement_costs.frozen|
cave: $unit.movement_costs.cave|
shallow water: $unit.movement_costs.shallow_water|
swamp: $unit.movement_costs.swamp_water|
castle: $unit.movement_costs.castle|
fungus: $unit.movement_costs.fungus|</small>"

                                        [option]
                                            message={MENU_IMG_TXT "misc/red-x.png" (_"Done")}
                                            [command]
                                                {VARIABLE finished_sub yes}
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/grass/green.png" "15 gold: flat costs 1 mp"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=unit.movement_costs.flat
                                                        greater_than=1
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=terup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=movement_costs
                                                                replace=yes
                                                                [movement_costs]
                                                                    flat=1
                                                                [/movement_costs]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP terup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/forest/pine-tile.png" "15 gold: forest costs 1 mp"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=unit.movement_costs.forest
                                                        greater_than=1
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=terup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=movement_costs
                                                                replace=yes
                                                                [movement_costs]
                                                                    forest=1
                                                                [/movement_costs]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP terup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/hills/regular.png" "15 gold: hills costs 1 mp"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=unit.movement_costs.hills
                                                        greater_than=1
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=terup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=movement_costs
                                                                replace=yes
                                                                [movement_costs]
                                                                    hills=1
                                                                [/movement_costs]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP terup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/mountains/basic-tile.png" "15 gold: mountains costs 1 mp"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=unit.movement_costs.mountains
                                                        greater_than=1
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=terup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=movement_costs
                                                                replace=yes
                                                                [movement_costs]
                                                                    mountains=1
                                                                [/movement_costs]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP terup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/sand/beach.png" "15 gold: sand costs 1 mp"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=unit.movement_costs.sand
                                                        greater_than=1
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=terup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=movement_costs
                                                                replace=yes
                                                                [movement_costs]
                                                                    sand=1
                                                                [/movement_costs]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP terup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/frozen/ice.png" "15 gold: frozen costs 1 mp"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=unit.movement_costs.frozen
                                                        greater_than=1
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=terup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=movement_costs
                                                                replace=yes
                                                                [movement_costs]
                                                                    frozen=1
                                                                [/movement_costs]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP terup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/cave/floor.png" "15 gold: cave costs 1 mp"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=unit.movement_costs.cave
                                                        greater_than=1
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=terup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=movement_costs
                                                                replace=yes
                                                                [movement_costs]
                                                                    cave=1
                                                                [/movement_costs]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP terup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/water/ocean-tile.png" "15 gold: shallow water costs 1 mp"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=unit.movement_costs.shallow_water
                                                        greater_than=1
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=terup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=movement_costs
                                                                replace=yes
                                                                [movement_costs]
                                                                    shallow_water=1
                                                                [/movement_costs]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP terup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/swamp/water-tile.png" "15 gold: swamp costs 1 mp"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=unit.movement_costs.swamp_water
                                                        greater_than=1
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=terup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=movement_costs
                                                                replace=yes
                                                                [movement_costs]
                                                                    swamp_water=1
                                                                [/movement_costs]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP terup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/castle/castle-tile.png" "15 gold: castle costs 1 mp"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=unit.movement_costs.castle
                                                        greater_than=1
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=terup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=movement_costs
                                                                replace=yes
                                                                [movement_costs]
                                                                    castle=1
                                                                [/movement_costs]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP terup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/forest/mushrooms-beam-tile.png" "15 gold: fungus costs 1 mp"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=unit.movement_costs.fungus
                                                        greater_than=1
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=terup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=movement_costs
                                                                replace=yes
                                                                [movement_costs]
                                                                    fungus=1
                                                                [/movement_costs]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP terup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        image=wesnoth-icon.png
                                    [/message]
                                    [redraw]
                                    [/redraw]
                                [/do]
                            [/while]
                        [/command]
                    [/option]

                    [option]
                        [show_if]
                            [variable]
                                name=unit.advancement.id
                                equals=amla_default
                            [/variable]
                        [/show_if]
                        message={MENU_IMG_TXT "icons/jewelry_necklace_amber.png" (_"Defenses")}
                        [command]
                            {VARIABLE finished_sub no}
                            [while]
                                [variable]
                                    name=finished_sub
                                    equals=no
                                [/variable]
                                [do]
                                    {STORE_VARIABLES}

                                    {VARIABLE defense.flat 100}
                                    {VARIABLE defense.forest 100}
                                    {VARIABLE defense.hills 100}
                                    {VARIABLE defense.mountains 100}
                                    {VARIABLE defense.sand 100}
                                    {VARIABLE defense.frozen 100}
                                    {VARIABLE defense.cave 100}
                                    {VARIABLE defense.shallow_water 100}
                                    {VARIABLE defense.swamp_water 100}
                                    {VARIABLE defense.castle 100}
                                    {VARIABLE defense.fungus 100}
                                    {VARIABLE_OP defense.flat add -$unit.defense.flat|}
                                    {VARIABLE_OP defense.forest add -$unit.defense.forest|}
                                    {VARIABLE_OP defense.hills add -$unit.defense.hills|}
                                    {VARIABLE_OP defense.mountains add -$unit.defense.mountains|}
                                    {VARIABLE_OP defense.sand add -$unit.defense.sand|}
                                    {VARIABLE_OP defense.frozen add -$unit.defense.frozen|}
                                    {VARIABLE_OP defense.cave add -$unit.defense.cave|}
                                    {VARIABLE_OP defense.shallow_water add -$unit.defense.shallow_water|}
                                    {VARIABLE_OP defense.swamp_water add -$unit.defense.swamp_water|}
                                    {VARIABLE_OP defense.castle add -$unit.defense.castle|}
                                    {VARIABLE_OP defense.fungus add -$unit.defense.fungus|}

                                    [message]
                                        speaker=narrator
                                        caption= _ "Defenses"
                                        message= _ "<span color='gold'>Gold: $gold|</span>
<b>Training left: $defup_left_$side_number||</b>

<i>Current defenses (max: 80%):</i>
<small>flat: $defense.flat|%
forest: $defense.forest|%
hills: $defense.hills|%
mountains: $defense.mountains|%
sand: $defense.sand|%
frozen: $defense.frozen|%
cave: $defense.cave|%
shallow water: $defense.shallow_water|%
swamp: $defense.swamp_water|%
castle: $defense.castle|%
fungus: $defense.fungus|%</small>"

                                        [option]
                                            message={MENU_IMG_TXT "misc/red-x.png" (_"Done")}
                                            [command]
                                                {VARIABLE finished_sub yes}
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/grass/green.png" "20 gold: +10% flat defense"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=defense.flat
                                                        less_than=80
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=20
                                                    [/variable]
                                                    [variable]
                                                        name=defup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-20
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=defense
                                                                replace=no
                                                                [defense]
                                                                    flat=-10
                                                                [/defense]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP defup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/forest/pine-tile.png" "15 gold: +10% forest defense"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=defense.forest
                                                        less_than=80
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=defup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=defense
                                                                replace=no
                                                                [defense]
                                                                    forest=-10
                                                                [/defense]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP defup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/hills/regular.png" "15 gold: +10% hills defense"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=defense.hills
                                                        less_than=80
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=defup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=defense
                                                                replace=no
                                                                [defense]
                                                                    hills=-10
                                                                [/defense]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP defup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/mountains/basic-tile.png" "15 gold: +10% mountains defense"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=defense.mountains
                                                        less_than=80
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=defup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=defense
                                                                replace=no
                                                                [defense]
                                                                    mountains=-10
                                                                [/defense]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP defup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/sand/beach.png" "15 gold: +10% sand defense"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=defense.sand
                                                        less_than=80
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=defup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=defense
                                                                replace=no
                                                                [defense]
                                                                    sand=-10
                                                                [/defense]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP defup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/frozen/ice.png" "15 gold: +10% frozen defense"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=defense.frozen
                                                        less_than=80
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=defup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=defense
                                                                replace=no
                                                                [defense]
                                                                    frozen=-10
                                                                [/defense]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP defup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/cave/floor.png" "15 gold: +10% cave defense"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=defense.cave
                                                        less_than=80
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=defup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=defense
                                                                replace=no
                                                                [defense]
                                                                    cave=-10
                                                                [/defense]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP defup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/water/ocean-tile.png" "15 gold: +10% shallow water defense"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=defense.shallow_water
                                                        less_than=80
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=defup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=defense
                                                                replace=no
                                                                [defense]
                                                                    shallow_water=-10
                                                                [/defense]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP defup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/swamp/water-tile.png" "15 gold: +10% swamp defense"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=defense_swamp.water
                                                        less_than=80
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=defup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=defense
                                                                replace=no
                                                                [defense]
                                                                    swamp_water=-10
                                                                [/defense]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP defup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/castle/castle-tile.png" "15 gold: +10% castle defense"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=defense.castle
                                                        less_than=80
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=defup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=defense
                                                                replace=no
                                                                [defense]
                                                                    castle=-10
                                                                [/defense]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP defup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "terrain/forest/mushrooms-beam-tile.png" "15 gold: +10% fungus defense"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=defense.fungus
                                                        less_than=80
                                                    [/variable]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=15
                                                    [/variable]
                                                    [variable]
                                                        name=defup_left_$side_number|
                                                        greater_than=0
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-15
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=defense
                                                                replace=no
                                                                [defense]
                                                                    fungus=-10
                                                                [/defense]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP defup_left_$side_number add -1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "misc/red-x.png" (_"Done")}
                                            [command]
                                                {VARIABLE finished_sub yes}
                                            [/command]
                                        [/option]

                                        image=wesnoth-icon.png
                                    [/message]
                                    [redraw]
                                    [/redraw]
                                [/do]
                            [/while]
                        [/command]
                    [/option]

                    [option]
                        [show_if]
                            [variable]
                                name=newabi_$side_number|
                                equals=0
                            [/variable]
                        [/show_if]

                        message={MENU_IMG_TXT "icons/helmet_crested.png" (_"New Ability")}
                        [command]
                            {VARIABLE finished_sub no}
                            [while]
                                [variable]
                                    name=finished_sub
                                    equals=no
                                [/variable]
                                [variable]
                                    name=newabi_$side_number|
                                    equals=0
                                [/variable]
                                [do]
                                    [store_gold]
                                        side=$side_number
                                        variable=gold
                                    [/store_gold]

                                    [message]
                                        speaker=narrator
                                        caption= _ "New Ability"
                                        message= _ "<span color='gold'>Gold: $gold|</span>

Only 1 ability can be bought."

                                        [option]
                                            message={MENU_IMG_TXT "misc/red-x.png" (_"Done")}
                                            [command]
                                                {VARIABLE finished_sub yes}
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "scenery/well.png" "50 gold: regenerates"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=50
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-50
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=new_ability
                                                                [abilities]
                                                                    {ABILITY_REGENERATES}
                                                                [/abilities]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP newabi_$side_number| add 1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "scenery/circle-magic-glow.png" "30 gold: steadfast"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=30
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-30
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=new_ability
                                                                [abilities]
                                                                    {ABILITY_STEADFAST}
                                                                [/abilities]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP newabi_$side_number| add 1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "scenery/lighthouse.png" "20 gold: heals +8"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=20
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-20
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=new_ability
                                                                [abilities]
                                                                    {ABILITY_EXTRA_HEAL}
                                                                [/abilities]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP newabi_$side_number| add 1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "scenery/oak-leaning.png" "10 gold: cures"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=10
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-10
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=new_ability
                                                                [abilities]
                                                                    {ABILITY_UNPOISON}
                                                                [/abilities]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP newabi_$side_number| add 1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "scenery/rock-cairn.png" "35 gold: feeding"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=35
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-35
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            #                                                             [effect]
                                                            #                                                                 apply_to=new_ability
                                                            #                                                                 [abilities]
                                                            #                                                                     {ABILITY_FEEDING}
                                                            #                                                                 [/abilities]
                                                            #                                                             [/effect]
                                                            #                                                             [effect]
                                                            #                                                                 apply_to=remove_ability
                                                            #                                                                 [abilities]
                                                            #                                                                     [dummy]
                                                            #                                                                         id=feeding
                                                            #                                                                     [/dummy]
                                                            #                                                                 [/abilities]
                                                            #                                                             [/effect]
                                                            [effect]
                                                                apply_to=new_ability
                                                                [abilities]
                                                                    [dummy]
                                                                        id=feeding$side_number|
                                                                        name= _ "feeding +$custom_feed$side_number||"
                                                                        female_name= _ "female^feeding +$custom_feed$side_number||"
                                                                        description=_ "Feeding +$custom_feed$side_number||:
This unit gains $custom_feed$side_number|| hitpoint added to its maximum whenever it kills a living unit."
                                                                    [/dummy]
                                                                [/abilities]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP newabi_$side_number| add 1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "scenery/leanto.png" "30 gold: skirmisher"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=30
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-30
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=new_ability
                                                                [abilities]
                                                                    {ABILITY_SKIRMISHER}
                                                                [/abilities]
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP newabi_$side_number| add 1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        image=wesnoth-icon.png
                                    [/message]
                                    [redraw]
                                    [/redraw]
                                [/do]
                            [/while]
                        [/command]
                    [/option]

                    [option]
                        [show_if]
                            [variable]
                                name=new_weapon_$side_number|
                                equals=0
                            [/variable]
                        [/show_if]

                        message={MENU_IMG_TXT "icons/crossed_sword_and_hammer.png" (_"New Weapon")}
                        [command]
                            {VARIABLE finished_sub no}
                            [while]
                                [variable]
                                    name=finished_sub
                                    equals=no
                                [/variable]
                                [variable]
                                    name=new_weapon_$side_number|
                                    equals=0
                                [/variable]
                                [do]
                                    [store_gold]
                                        side=$side_number
                                        variable=gold
                                    [/store_gold]

                                    [message]
                                        speaker=narrator
                                        caption= _ "New Weapon"
                                        message= _ "<span color='gold'>Gold: $gold|</span>

Only 1 weapon can be bought."

                                        [option]
                                            message={MENU_IMG_TXT "misc/red-x.png" (_"Done")}
                                            [command]
                                                {VARIABLE finished_sub yes}
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "attacks/whip.png" "25 gold: Whip of Hell"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=25
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-25
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=new_attack
                                                                name="whip of hell"
                                                                description= _ "whip of hell"
                                                                icon="attacks/whip.png"
                                                                type=fire
                                                                range=melee
                                                                [specials]
                                                                    {WEAPON_SPECIAL_SWARM}
                                                                [/specials]
                                                                damage=2
                                                                number=8
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP new_weapon_$side_number| add 1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "attacks/gaze.png" "40 gold: Eye of Dread"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=40
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-40
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=new_attack
                                                                name="eye of dread"
                                                                description= _ "eye of dread"
                                                                icon="attacks/gaze.png"
                                                                type=cold
                                                                range=ranged
                                                                [specials]
                                                                    {WEAPON_SPECIAL_DRAIN}
                                                                [/specials]
                                                                damage=6
                                                                number=2
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP new_weapon_$side_number| add 1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "attacks/battleaxe.png" "45 gold: Battleaxe of Knalga"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=45
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-45
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=new_attack
                                                                name="battleaxe"
                                                                description= _ "battleaxe"
                                                                icon="attacks/battleaxe.png"
                                                                type=blade
                                                                range=melee
                                                                [specials]
                                                                    {WEAPON_SPECIAL_BERSERK}
                                                                [/specials]
                                                                damage=6
                                                                number=4
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP new_weapon_$side_number| add 1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "attacks/lightbeam.png" "30 gold: Stormtrident"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=30
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-30
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=new_attack
                                                                name="stormtrident"
                                                                description= _ "stormtrident"
                                                                icon="attacks/lightbeam.png"
                                                                type=arcane
                                                                range=ranged
                                                                [specials]
                                                                    {WEAPON_SPECIAL_MAGICAL}
                                                                [/specials]
                                                                damage=9
                                                                number=3
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP new_weapon_$side_number| add 1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "attacks/hammer-dwarven.png" "35 gold: Hammer of Thursagan"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=30
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-30
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=new_attack
                                                                name="hammer of thursagan"
                                                                description= _ "hammer of thursagan"
                                                                icon="attacks/hammer-dwarven.png"
                                                                type=impact
                                                                range=melee
                                                                [specials]
                                                                    {WEAPON_SPECIAL_SLOW}
                                                                [/specials]
                                                                damage=14
                                                                number=2
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP new_weapon_$side_number| add 1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]

                                        [option]
                                            message={MENU_IMG_TXT "attacks/bow-elven.png" "35 gold: Bullseye"}
                                            [command]
                                                [if]
                                                    [variable]
                                                        name=gold
                                                        greater_than_equal_to=30
                                                    [/variable]
                                                    [then]
                                                        [gold]
                                                            amount=-30
                                                            side=$side_number
                                                        [/gold]
                                                        [object]
                                                            silent=yes
                                                            [effect]
                                                                apply_to=new_attack
                                                                name="bullseye"
                                                                description= _ "bullseye"
                                                                icon="attacks/bow-elven.png"
                                                                type=pierce
                                                                range=ranged
                                                                [specials]
                                                                    {WEAPON_SPECIAL_MARKSMAN}
                                                                [/specials]
                                                                damage=7
                                                                number=4
                                                            [/effect]
                                                        [/object]
                                                        {VARIABLE_OP new_weapon_$side_number| add 1}
                                                    [/then]
                                                [/if]
                                            [/command]
                                        [/option]
                                    [/message]
                                [/do]
                            [/while]
                        [/command]
                    [/option]
                [/message]
            [/do]
        [/while]
    [/event]

    [event]
        name=side turn end
        first_time_only=no

        [if]
            [variable]
                name=colosseum_rest
                equals=on
            [/variable]
            [have_unit]
                x=23
                y=29
            [/have_unit]
            [then]
                [teleport]
                    [filter]
                        side=2
                        x=23
                        y=29
                    [/filter]
                    x=23
                    y=28
                [/teleport]
                [teleport]
                    [filter]
                        side=3
                        x=23
                        y=29
                    [/filter]
                    x=24
                    y=29
                [/teleport]
                [teleport]
                    [filter]
                        side=4
                        x=23
                        y=29
                    [/filter]
                    x=24
                    y=30
                [/teleport]
                [teleport]
                    [filter]
                        side=5
                        x=23
                        y=29
                    [/filter]
                    x=23
                    y=30
                [/teleport]
                [teleport]
                    [filter]
                        side=6
                        x=23
                        y=29
                    [/filter]
                    x=22
                    y=30
                [/teleport]
                [teleport]
                    [filter]
                        side=1
                        x=23
                        y=29
                    [/filter]
                    x=22
                    y=29
                [/teleport]
            [/then]
        [/if]
    [/event]
#enddef
